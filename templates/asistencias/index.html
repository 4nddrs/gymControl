{% extends "base.html" %}

{% block title %}{{ titulo }} - VITO'S GYM{% endblock %}

{% block content %}
<div class="page-header">
    <h2>ğŸ“‹ {{ titulo }}</h2>
    <div style="display: flex; gap: 1rem;">
        <a href="{{ url_for('asistencias.registrar') }}" class="btn btn-primary">+ Registrar Asistencia</a>
        <a href="{{ url_for('asistencias.estadisticas') }}" class="btn btn-secondary">ğŸ“Š EstadÃ­sticas</a>
    </div>
</div>

<!-- Filtro de fecha -->
<div class="content-section" style="margin-bottom: 1.5rem;">
    <form method="GET" action="{{ url_for('asistencias.index') }}" style="display: flex; gap: 1rem; align-items: center;">
        <label style="font-weight: bold;">Fecha:</label>
        <input type="date" 
               name="fecha" 
               value="{{ fecha }}" 
               style="padding: 0.75rem; border: 2px solid var(--border-color); border-radius: 6px; font-size: 1rem;">
        <button type="submit" class="btn btn-primary">Filtrar</button>
        <a href="{{ url_for('asistencias.index') }}" class="btn btn-secondary">Hoy</a>
    </form>
</div>

<!-- Lista de asistencias -->
<div class="content-section">
    <div style="margin-bottom: 1rem;">
        <h3>Total de asistencias: <span style="color: var(--primary-color);">{{ asistencias|length }}</span></h3>
    </div>
    
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="border-bottom: 2px solid var(--primary-color); text-align: left;">
                <th style="padding: 1rem;">Foto</th>
                <th style="padding: 1rem;">Usuario</th>
                <th style="padding: 1rem;">Hora</th>
                <th style="padding: 1rem;">MÃ©todo</th>
                <th style="padding: 1rem;">Departamento</th>
                <th style="padding: 1rem;">Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for asistencia in asistencias %}
            <tr style="border-bottom: 1px solid var(--border-color);">
                <td style="padding: 1rem;">
                    <img src="{{ url_for('fotos.get_foto', usuario_id=asistencia.usuario_id) }}" 
                         alt="{{ asistencia.usuario_nombre }}"
                         style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary-color);">
                </td>
                <td style="padding: 1rem;">
                    <strong>{{ asistencia.usuario_nombre }}</strong><br>
                    <small style="color: var(--text-light);">ID: {{ asistencia.usuario_id }}</small>
                </td>
                <td style="padding: 1rem;">
                    <strong>{{ asistencia.fecha.strftime('%H:%M:%S') if asistencia.fecha else 'N/A' }}</strong>
                </td>
                <td style="padding: 1rem;">{%  if asistencia.metodo_registro == 'biometrico' %}
                    <span style="background: var(--success-color); color: white; padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.85rem;">ğŸ”’ BiomÃ©trico</span>
                    {% else %}
                    <span style="background: var(--gray-300); color: var(--text-color); padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.85rem;">âœï¸ Manual</span>
                    {% endif %}
                </td>
                <td style="padding: 1rem;">{{ asistencia.departamento_nombre or 'N/A' }}</td>
                <td style="padding: 1rem;">
                    <a href="{{ url_for('asistencias.historial', usuario_id=asistencia.usuario_id) }}" 
                       style="color: var(--primary-color); text-decoration: none;">Ver historial</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6" style="padding: 2rem; text-align: center; color: var(--text-light);">
                    No hay asistencias registradas para esta fecha
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
